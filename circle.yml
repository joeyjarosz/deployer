machine:
  services:
    - docker
  environment:
    CGO_ENABLED: 0
    GOARCH: amd64
    GOOS: linux

checkout:
  post:
    - rm -rf ~/.go_workspace/src/github.com/jsdir/deployer
    - mkdir -p ~/.go_workspace/src/github.com/jsdir/deployer
    - cp -R ~/deployer ~/.go_workspace/src/github.com/jsdir/deployer

dependencies:
  override:
    - cd github.com/jsdir/deployer; go get
    - go build -v github.com/jsdir/deployer/...

test:
  override:
    - go test -v github.com/jsdir/deployer/...
  post:
    - ls ~/.go_workspace/src/github.com/jsdir/deployer
#    - ldd ./deployer
#    - ldd ./deployerd

deployment:
  hub:
    branch: master
    commands:
      - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
      - docker push jsdir/deployer
